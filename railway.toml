[build]
builder = "NIXPACKS"

[[services]]
name = "m-api"
source = "services/m-api"
startCommand = "php -S 0.0.0.0:$PORT index.php"

[[services]]
name = "o-api"
source = "services/o-api"
startCommand = "php -S 0.0.0.0:$PORT index.php"

[[services]]
name = "c-api"
source = "services/c-api"
startCommand = "php -S 0.0.0.0:$PORT index.php"

[[services]]
name = "s-api"
source = "services/s-api"
startCommand = "php -S 0.0.0.0:$PORT index.php"

[[services]]
name = "a-api"
source = "services/a-api"
startCommand = "php -S 0.0.0.0:$PORT index.php"

[[services]]
name = "db-migrator"
source = "scripts"
startCommand = "php -S 0.0.0.0:$PORT index.php"

[[services]]
name = "website-wp"
source = "services/website-wp"

[services.website-wp.build]
dockerfilePath = "Dockerfile"

[services.website-wp.deploy]
startCommand = "/bin/bash /var/www/html/init.sh"
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 3

# Environment variables needed (set in Railway dashboard):
# MYSQL_HOST, MYSQL_DATABASE, MYSQL_USER, MYSQL_PASSWORD
# WP_ADMIN_USER, WP_ADMIN_PASSWORD, WP_ADMIN_EMAIL
# WP_AUTH_KEY, WP_SECURE_AUTH_KEY, etc (8 keys total)
# LSE_M_API_URL, LSE_API_KEY

[deploy.restartPolicy]
type = "ON_FAILURE"

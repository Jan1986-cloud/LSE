[build]
builder = "NIXPACKS"

[deploy]
startCommand = "php -S 0.0.0.0:$PORT index.php"

[[services]]
name = "m-api"
source = "services/m-api"

[[services]]
name = "o-api"
source = "services/o-api"
# O-API is internal. Configure visibility via Railway UI.

[[services]]
name = "c-api"
source = "services/c-api"

[[services]]
name = "s-api"
source = "services/s-api"

[[services]]
name = "a-api"
source = "services/a-api"

[[services]]
name = "db-migrator"
source = "scripts"
startCommand = "php run_migrations.php"
# This service runs migrations as a one-off job.

[deploy.restartPolicy]
type = "ON_FAILURE"
